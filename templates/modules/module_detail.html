{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h1>{{ module.title }}</h1>
            <div class="progress mb-3">
                <div class="progress-bar" role="progressbar" 
                     style="width: {{ progress.completion_percentage }}%"
                     aria-valuenow="{{ progress.completion_percentage }}" 
                     aria-valuemin="0" 
                     aria-valuemax="100">
                    {{ progress.completion_percentage }}%
                </div>
            </div>
            <div class="d-flex justify-content-between mb-3">
                <span>Time Spent: {{ progress.time_spent|default:"0:00:00" }}</span>
                <span>Status: {% if progress.is_completed %}Completed{% else %}In Progress{% endif %}</span>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Description</h5>
                    <p class="card-text">{{ module.description }}</p>
                </div>
            </div>
            <div class="card mt-3">
                <div class="card-body">
                    <h5 class="card-title">Content</h5>
                    <div class="module-content">
                        {{ module.content|safe }}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Module Details</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>Duration:</strong> {{ module.duration }} hours
                        </li>
                        <li class="list-group-item">
                            <strong>Difficulty:</strong> {{ module.difficulty_level }}
                        </li>
                        <li class="list-group-item">
                            <strong>Started:</strong> {{ progress.started_at|date:"F j, Y" }}
                        </li>
                        {% if progress.completed_at %}
                        <li class="list-group-item">
                            <strong>Completed:</strong> {{ progress.completed_at|date:"F j, Y" }}
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    // Update progress every 30 seconds
    setInterval(function() {
        fetch('{% url "modules:update_progress" module.id %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: 'percentage={{ progress.completion_percentage }}'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.querySelector('.progress-bar').style.width = data.percentage + '%';
                document.querySelector('.progress-bar').setAttribute('aria-valuenow', data.percentage);
                document.querySelector('.progress-bar').textContent = data.percentage + '%';
                document.querySelector('.time-spent').textContent = 'Time Spent: ' + data.time_spent;
            }
        });
    }, 30000);
</script>
{% endblock %}
{% endblock %} 